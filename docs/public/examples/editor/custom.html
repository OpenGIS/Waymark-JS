<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Waymark JS | Editor | Custom</title>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="../../dist/1.0/css/waymark-js.css" />
    <link rel="stylesheet" href="../assets/css/examples.css" />

    <style>
      /* Toggle Button  */
      #waymark-map button.canada-toggle {
        position: absolute;
        bottom: 10px;
        right: 10px;
        padding: 5px 10px;
        z-index: 2000000;
        font-size: 42px;
        background: red;
        border: 3px solid #fff;
        border-radius: 5px;
      }
      #waymark-map.oh-canada button.canada-toggle {
        /* Invert colours  */
        filter: invert(100%);
      

      }


      /* Canada Styles... */
      #waymark-map.oh-canada .leaflet-tile-pane {
        /* Grayscale Basemap */
        filter: grayscale(100%);
      }

      /* Target by the "Beer" Type Key  */
      #waymark-map.oh-canada .waymark-marker.waymark-marker-beer .waymark-marker-background {
        background-color: white !important;
      }
      #waymark-map.oh-canada .waymark-marker.waymark-marker-beer .waymark-icon-text {
        color: red !important;
      }

      /* Markers  */
      #waymark-map.oh-canada .waymark-marker .waymark-marker-background {
        background-color: #ff0000 !important;
      }
      #waymark-map.oh-canada .waymark-marker .waymark-icon-text {
        color: #fff !important;
      }

      /* Toolbar  */
      #waymark-map.oh-canada .waymark-edit-toolbar a:not(.waymark-icon) {
        color: #ffffff !important;
        background: #ff0000 !important;
      }

      /* Hide */
      .leaflet-bottom.leaflet-right,
      #waymark-data {
        display: none;  
      }      
    </style>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="../../dist/1.0/js/waymark-js.js"></script>
  </head>
  <body>
    <div id="waymark-map"></div>

    <script>
      // Create Editor Instance
      const viewer = window.Waymark_Map_Factory.editor();

      // Load Configuration from file
      fetch("../assets/config/route.json")
        .then((response) => response.json())
        .then((config) => {
          // Modify config...

          // Disable Save Confirmation

          config.editor_options = {
            confirm_delete: false
          };

          // Iterate over Marker Types
          config.map_options.marker_types.forEach((marker_type) => {
            // Change Marker Colour
            marker_type.icon_type = "text";
            marker_type.marker_icon = "ðŸ‡¨ðŸ‡¦" + marker_type.marker_title[0];
          });

          // Iterate over Line Types
          config.map_options.line_types.forEach((line_type) => {
            // Change Line Colour
            line_type.line_colour = "#ff0000";
          });

          // Initialise with our options
          viewer.init(config);

          // Get the container with jQuery
          const map_container = jQuery("#waymark-map");

          // Add a class to the container
          map_container.addClass("oh-canada");

          // Create a toggle button
          const toggle_button = jQuery("<button />")
            .addClass("canada-toggle")
            .text("ðŸ‡¨ðŸ‡¦")
            .on("click", () => {
              map_container.toggleClass("oh-canada");
            });

          

          // Append to the container
          map_container.append(toggle_button);




          // Load GeoJSON
          fetch("../assets/geo/route.geojson")
            .then((response) => response.json())
            .then((geojson) => {
              // Modify geojson...
              geojson.features.forEach((feature) => {
                // Not the pub
                if (feature.properties.type == "beer") {
                  return;
                }

                // Set all images to the Canadian Flag
                const flag_url = "../assets/img/canada.svg";
                feature.properties.image_large_url = flag_url;
                feature.properties.image_medium_url = flag_url;
                feature.properties.image_thumbnail_url = flag_url;
              });

              // Add to Map
              viewer.load_json(geojson);

              // Once loaded...
              // Iterate over the Leaflet data layer
              viewer.map_data.eachLayer((layer) => {
                if (
                  layer.feature.properties.title &&
                  layer.feature.properties.title.includes("Scarlet")
                ) {
                  layer.openPopup();
                }
              });
            });
        });
    </script>
  </body>
</html>
